<?
########################################
#                                      #
# Community Applications               #
# Copyright 2020-2025, Lime Technology #
# Copyright 2015-2025, Andrew Zawadzki #
#                                      #
# Licenced under GPLv2                 #
#                                      #
########################################
?>

<?
#############################################################################################################
# JS to adjust the layout of the DOM and move elements around as needed outside of the Dynamix display area #
#############################################################################################################
?>
<script>

$(function() {
  // Add the HTML classes to the html element
  $("html").addClass("<?=$htmlClasses?>");

  // Position the search area so it's sticky.  (Pre 7.2 sticky isn't supported on azure or gray themes)
  <? if ( $responsiveOS || ($display['theme'] == 'black' || $display['theme'] == 'white') ):?>
    $(".searchAreaHolder").insertAfter("#menu");
  <? endif; ?>

  // Move the sidebar to the body so it fills the entire screen.
  $(".sidebar,.ca_statusArea").appendTo("body");
  
  // Add caDimmable to other elements outside of CA's DOM
  // Elements within CA's DOM have the class within the HTML below

  // Dimming happens when certain conditions are met within the main CA CSS file
  $("#header, #menu,#footer,.upgrade_notice").addClass("caDimmable");

  $("body,.content").addClass("menuAdjust");

  // Override the OS switch language function so that CA can save it's current state when switching via the OS
  $(".LanguageButton").find("a").attr("onclick","CAswitchLanguage('<?=$previousLocale?>')");
  
});
</script>

<!-- Search Area - This gets moved to body on responsive and black and white themes on legacy OS -->
<div class="searchAreaHolder menuAdjust">
  <div class='searchArea onlyShowWithFeed'>
    <div class='mobileMenuButton'>
      <div class='showMenuButton menuAdjust menuHidden' title="<?tr("Show Menu");?>"></div>
      <div class='closeMenuButton menuAdjust menuHidden' title="<?tr("Close Menu");?>"></div>
    </div>
    <div id='searchFilter' class='hideWithMenu'>
      <input type='text' id='searchBox' placeholder='<?tr('Search');?>'>
      <span class='searchSubmit'><i id='searchButton' class='fa fa-search fa-lg'></i></span>
    </div>
    <div class='caButton maxPerPage hideWithMenu' id='maxPerPage'></div>
    <div class='dockerSearch caButton hideWithMenu ca_hide' title="<?tr("Search dockerHub for more containers");?>"><?tr("DockerHub");?></div>
    <div class='templateSearch caButton hideWithMenu ca_hide' title="<?tr("Search for applications from");?>"><?tr("Apps")?></div>
    <div class='category categoryLine hideWithMenu'></div>
    <div class='category altCategoryLine hideWithMenu'></div>
  </div>
</div>

<!-- Status Bar.   This gets moved to the body -->
<div class='ca_statusArea'>
  <span class='caDownloadProgress ca_hide'></span>
  <span class='caStatusText'></span>
</div>

</div>
<!-- Main Display Area -->
<div class='ca_display_area caDimmable'>
  <div class='mobileOverlay menuAdjust menuHidden' role='modal'><div class='mobileOverlayOutsideClick'></div></div>
  <div class='mobileMenu' id='mobileMenu'>
    <div class='menuItems menuAdjust'>
      <ul class='caMenu '>
        <li class='startupButton caMenuItem onlyShowWithFeed' data-category='new'><?tr("Home");?></li>
        <li><hr class='onlyShowWithFeed'/></li>
        <li class='caMenuItem sectionMenu onlyShowWithFeed' data-category='installed_apps'><?tr("Installed Apps");?>
        <li class='subCategory onlyShowWithFeed'>
          <ul class='caMenuItem sectionMenu onlyShowWithFeed dockerSpecific' data-category='inst_docker'><?tr("Docker");?></ul>
          <ul class='caMenuItem sectionMenu onlyShowWithFeed' data-category='inst_plugins'><?tr("Plugins");?></ul>
        </li>
        <li class='caMenuItem sectionMenu onlyShowWithFeed' data-category='previous_apps'><?tr("Previous Apps");?></li>
        <li class='subCategory onlyShowWithFeed'>
          <ul class='caMenuItem sectionMenu dockerSpecific' data-category='prev_docker'><?tr("Docker");?></ul>
          <ul class='caMenuItem sectionMenu' data-category='prev_plugins'><?tr("Plugins");?></ul>
        </li>
        <li class='caMenuItem sectionMenu caPinnedMenu onlyShowWithFeed' data-category='pinned_apps'><?tr("Pinned Apps");?></li>
        <li class='caMenuItem favouriteRepo onlyShowWithFeed'><?tr("Favourite Repo");?></li>
        <li class='caMenuItem sectionMenu actionCentre onlyShowWithFeed' data-category='action_centre'><?tr("Action Centre");?></li>
        <li><hr class='onlyShowWithFeed'/></li>
      </ul>
        <span id='category_list' class='onlyShowWithFeed'></span>
      <ul class='caMenu'>
        <li class='categoryMenu caMenuItem allApps onlyShowWithFeed nonDockerSearch' data-category='All'><?tr("All Apps");?></li>
        <li class='caMenuItem'><hr class='category_hr onlyShowWithFeed'></li>
        <li class='categoryMenu caMenuItem caRepositoryMenu onlyShowWithFeed nonDockerSearch' data-category='repos'><?tr("Repositories");?></li>
        <li><hr class='category_hr onlyShowWithFeed'/></li>
        <li class='caMenuItem' onclick='window.location="/Apps/ca_settings"'><?tr("Settings");?></li>
        <li class='caMenuItem showStatistics noSelect'><?tr("Statistics");?></li>
        <li class='caMenuItem showCredits noSelect'><?tr("Credits");?></li>
        <li class='caMenuItem'><a class='caMenuItem' href='https://forums.unraid.net/topic/38582-plug-in-community-applications/' target='_blank'><?tr("Support");?></a></li>
        <li><hr class='category_hr'/></li>
        <li><?=tr("VERSION");?></li>
        <li><span id='caInstalledVersion'></span></li>
        <li class='caMenuItem caChangeLog noSelect'><?tr("Change Log");?></li>
        <?if ($md5Error):?>
        <li><span class='modifiedCode'>Modified Code</span></li>
        <br>
        <?endif;?>  
        <li><hr/></li>
        <li class='caMenuItem debugging noSelect'><?tr("Debugging");?></li>
      </ul>
    </div>
  </div>
  <div class='mainArea menuAdjust'>
    <div id='sortIconArea' class='menuAdjust'>
      <div class="category categoryLineNoMenu"></div>
      <?tr("Sort By:");?>
      <a id="defaultSort" class='sortIcons enabledIcon' data-sortBy='Name' data-sortDir='Up'><?tr("Name Ascending");?></a>
      <a class='sortIcons' data-sortBy='Name' data-sortDir='Down'><?tr("Name Descending");?></a>
      <a class='sortIcons' data-sortBy='downloads' data-sortDir='Down'><?tr("Downloads");?></a>
      <a class='sortIcons' data-sortBy='FirstSeen' data-sortDir='Down'><?tr("Date Added");?></a>
    </div>
    <div id='templates_content' class='menuAdjust'></div>
    <div class='multi_installDiv'>
      <input class='multi_install multi_installButton' type='button' value='<?tr("Install Selected Applications");?>' disabled>
      <input type='button' class='multi_installAll' value='<?tr("Select all on page");?>'>
      <input type='button' class='multi_installClear' value='<?tr("Clear");?>' disabled>
      <input type='button' class='multi_deleteButton ca_hide' value='<?tr("Delete");?>'>
    </div>
  </div>
</div>

<!-- Sidebar for the application description.   This gets moved to the body -->
<div class='sidebar' role='modal'>
  <div class='sidebarClose'></div>
  <div class='popupCloseArea'>
    <div class='popupCloseAreaButtons'>
      <span class='popUpClose caButton'><?tr("CLOSE");?></span>
      <span class='popUpBack caButton'><?tr("BACK");?></span>
    </div>
  </div>
  <div class='sidenav sidenavHide'>
    <div id='sidenavContent'></div>
  </div>
</div>

<!-- Templates / HTML for alternate views -->
<div class='ca_hide'>
  <!-- Loading screen for the sidebar -->
  <div id='sidebarLoading'>
    <div class='ca_center caLogoIcon'></div>
    <div class='ca_center ca_italic'><?tr("LOADING...")?></div>
  </div>
  <!-- Change log view -->
  <div id="caChangeLog">
    <div>
      <div class='ca_center caLogoIcon'></div>
      <div class='ca_center caChangelogTitle'><?tr("Community Applications Changelog")?></div>
      <div class='ca_center ca_italic'><?tr("Copyright")?> &copy; 2020-2025 Lime Technology, 2015-2025 Andrew Zawadzki</div>
      <div class='ca_center ca_italic'><?tr("All rights reserved.")?></div>
      <div class="caChanges"></div>
    </div>
  </div>
  <!-- Credits view -->
  <div id='caCredits'>
    <div class='credits'>
      <div class='ca_center caLogoIcon'></div>
      <div class='ca_center ca_creditTitle'>Community Applications</div>
      <div class='ca_center ca_creditheader'><?tr("Development");?></div>
      <div class='ca_center ca_credit'>Andrew Zawadzki, Lime Technology Inc</div>
      <div class='ca_center ca_creditheader'><?tr("Additional Contributions");?></div>
      <div class='ca_center ca_credit'>bonienl, Lime Technology Inc</div>
      <div class='ca_center ca_creditheader'><?tr("GUI Layout Design");?></div>
      <div class='ca_center ca_credit'>Magnus Eng√∏, Andrew Zawadzki, Lime Technology Inc</div>
      <div class='ca_center ca_creditheader'><?tr("Application Feed");?></div>
      <div class='ca_center ca_credit'>Andrew Zawadzki, Kode, Lime Technology Inc</div>
      <div class='ca_center ca_creditheader'><?tr("Additional Testing");?></div>
      <div class='ca_center ca_credit'>CHBMB, SpaceInvaderOne, Sparklyballs, wgstarks, DJoss, Zer0Nin3r, Mex, prostuff1, bonienl, ljm42, kizer, trurl, Jos, Lime Technology Inc, SimonF, ich777, jimmy898, Alex.b, neruve, Eugeni_CAT, ChaseCares, TheEyeTGuy, dlandon</div>
      <div class='ca_center ca_creditheader'><?tr("Additional Libraries");?></div>
      <div class='ca_center ca_credit'>
        <div>Awesomeplete (Lea Verou)</div>
        <div>Chart.js (various)</div>
        <div>chartjs-plugin-trendline (Marcus Alsterfjord)</div>
        <div>XML2Array/Array2XML (Miles Johnson) - <?tr("Modified by Andrew Zawadzki");?></div>
        <div>Magnific-Popup (Dmytro Semenov) - <?tr("Modified by Andrew Zawadzki");?></div>
      </div>
      <br>
      <div class='ca_center ca_italic'><?tr("Copyright");?> &copy; 2020-2025 Lime Technology, 2015-2025 Andrew Zawadzki</div>
    </div>
  </div>
  <!-- Statistics view -->
  <div id='caStatisticsTemplate'>    
    <div class='ca_statistics'>
      <div>
        <table>
          <thead>
           <tr style='height:6rem;'>
            <td colspan='2'>
              <div class='ca_center caLogoIcon'></div>
            </td>
          </tr>
          <tr>
            <td colspan='2'>
              <div class='ca_center' style='font-size:2rem;'>Community Applications</div>
            </td>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td class='ca_table'>
              <?tr("Last Change To Application Feed");?>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='updateTime'></span><br><span data-stat-html='currentServer'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <?tr("Docker Applications");?>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='docker'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <?tr("Plugin Applications");?>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='plugin'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <?tr("Templates");?>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='totalApplications'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <?tr("Official Containers");?>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='official'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a onclick='event.stopPropagation();showModeration("Repository","<?tr("Repositories");?>");' class='popUpLink'><?tr("Repositories");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='repositories'></span>
            </td>
          </tr>
          <tr data-stat-row='private'>
            <td class='ca_table'>
              <a class='popUpLink' data-category='PRIVATE' onclick='showSpecialCategory(this);'><?tr("Private Docker Applications");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='private'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' onclick='event.stopPropagation();showModeration("Invalid","<?tr("Invalid Templates");?>");'><?tr("Invalid Templates");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='invalidXML'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' onclick='event.stopPropagation();showModeration("Fixed","<?tr("Template Errors");?>");'><?tr("Template Errors");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='caFixed'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' data-category='BLACKLIST' onclick='showSpecialCategory(this);'><?tr("Blacklisted Apps");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='blacklist'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' data-category='INCOMPATIBLE' onclick='showSpecialCategory(this);'><?tr("Incompatible Applications");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='totalIncompatible'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' data-category='DEPRECATED' onclick='showSpecialCategory(this);'><?tr("Deprecated Applications");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='totalDeprecated'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' onclick='event.stopPropagation();showModeration("Moderation","<?tr("Moderation Entries");?>");'><?tr("Moderation Entries");?></a>
            </td>
            <td class='ca_stat'>
              <span data-stat-text='totalModeration'></span>
            </td>
          </tr>
          <tr>
            <td class='ca_table'>
              <a class='popUpLink' data-stat-href='primaryServerUrl' target='_blank'><?tr("Primary Server");?></a> / <a class='popUpLink' data-stat-href='backupServerUrl' target='_blank'> <?tr("Backup Server");?></a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <div class='ca_center'>
        <a class='popUpLink' href='https://forums.unraid.net/topic/87144-ca-application-policies/' target='_blank'><?tr("Application Policy");?></a>
      </div>
    </div>
  </div>
</div>
<!-- Debugging span 
  Not currently used, but a span at bottom of page that can be used to display debugging information
-->
<span id='debugging'></span>